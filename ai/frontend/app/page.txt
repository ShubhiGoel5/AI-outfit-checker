"use client"

import { useState } from "react"
import Header from "@/components/layout/header"
import PhotoUpload from "@/components/photo-upload"
import FitcheckDisplay from "@/components/results/fitcheck-display"
import { submitFitCheck } from "@/lib/api"
import type { AppState } from "@/lib/types"
import { Button } from "@/components/ui/button"

export default function FitCheckPage() {
  const [state, setState] = useState<AppState>({
    uploadedImage: null,
    isAnalyzing: false,
    showResults: false,
    analysisData: null,
  })

  const handleAnalyze = async () => {
    if (!state.uploadedImage) return

    setState((prev) => ({ ...prev, isAnalyzing: true }))

    try {
      const response = await submitFitCheck(state.uploadedImage)

      setState({
        uploadedImage: state.uploadedImage,
        isAnalyzing: false,
        showResults: true,
        analysisData: response,
      })
    } catch (err) {
      alert("Analysis failed. Try again.")
      setState((prev) => ({ ...prev, isAnalyzing: false }))
    }
  }

  const reset = () => {
    setState({
      uploadedImage: null,
      isAnalyzing: false,
      showResults: false,
      analysisData: null,
    })
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-orange-50 to-red-50">
      <Header />

      <main className="container mx-auto px-4 py-12">
        {!state.showResults ? (
          <div className="max-w-3xl mx-auto space-y-8">
            <PhotoUpload
              uploadedImage={state.uploadedImage}
              onImageUpload={(image) =>
                setState((prev) => ({ ...prev, uploadedImage: image }))
              }
            />

            {state.uploadedImage && (
              <div className="text-center">
                <Button
                  onClick={handleAnalyze}
                  disabled={state.isAnalyzing}
                  size="lg"
                  className="bg-gradient-to-r from-orange-500 to-red-500 text-white px-10 py-4 rounded-full font-bold"
                >
                  {state.isAnalyzing ? "Analyzing..." : "Analyze Fit"}
                </Button>
              </div>
            )}
          </div>
        ) : (
          <FitcheckDisplay
            data={state.analysisData!}
            onReset={reset}
          />
        )}
      </main>
    </div>
  )
}
